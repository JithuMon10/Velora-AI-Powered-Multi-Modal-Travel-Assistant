<!doctype html>
<html lang="en">
<head>
  <script>
    // Auto-detect base path based on current URL
    const basePath = window.location.pathname.includes('/frontend/') ? '..' : '';
    window.VELORA_CONFIG = { API_BASE: basePath };
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Velora ‚Äî AI Transit Planner for India</title>
  <script>
    // Force reload if cached version detected
    if (performance.navigation.type === 2) {
      location.reload(true);
    }
  </script>
  <link rel="stylesheet" href="https://unpkg.com/[REDACTED]/dist/leaflet.css" crossorigin="" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; overflow: hidden; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:#0f172a; background:#f8f9fa; }
    #app { position:relative; height:100%; }

    /* Minimal Top Bar - Like Google Maps */
    .top-bar { position:absolute; top:0; left:0; right:0; height:64px; background:rgba(255,255,255,0.98); backdrop-filter:blur(20px); box-shadow:0 2px 12px rgba(0,0,0,0.08); z-index:1500; display:flex; align-items:center; padding:0 24px; justify-content:space-between; }
    .brand { display:flex; align-items:center; gap:12px; }
    .brand .logo { width:40px; height:40px; border-radius:12px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); display:flex; align-items:center; justify-content:center; color:#fff; font-size:24px; box-shadow:0 4px 12px rgba(102,126,234,0.3); }
    .brand-text { font-size:24px; font-weight:800; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); [REDACTED]:text; [REDACTED]:transparent; background-clip:text; }
    .top-bar-actions { display:flex; gap:12px; align-items:center; }
    .ac-wrap { position:relative; }
    .ac-input { width:100%; padding:11px 14px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; font-size:14px; transition:all 0.2s; }
    .ac-input:focus { outline:none; border-color:#3b82f6; box-shadow:0 0 0 3px rgba(59,130,246,0.1); }
    .action-btn { padding:14px 24px; border-radius:12px; border:none; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; font-weight:600; cursor:pointer; font-size:15px; transition:all 0.3s; box-shadow:0 4px 12px rgba(102,126,234,0.3); }
    .action-btn:hover { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,0.4); }
    .action-btn:hover:not(:disabled) { transform:translateY(-2px); box-shadow:0 6px 20px rgba(102,126,234,0.4); }
    .action-btn:active:not(:disabled) { transform:translateY(0); }
    .action-btn:disabled { background:#cbd5e1; cursor:not-allowed; box-shadow:none; }
    .ghost-btn { padding:10px 14px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; color:#475569; cursor:pointer; font-size:14px; transition:all 0.2s; }
    .ghost-btn:hover { background:#f8fafc; border-color:#94a3b8; }
    .form-msg { grid-column:1 / -1; color:#dc2626; font-size:13px; font-weight:500; }
    .ac-list { position:absolute; top:calc(100% + 4px); left:0; right:0; background:#fff; border:1px solid #e2e8f0; border-radius:12px; max-height:280px; overflow:auto; z-index:1600; box-shadow:0 10px 30px rgba(15,23,42,0.12); }
    .ac-item { padding:12px 14px; display:flex; justify-content:space-between; cursor:pointer; border-bottom:1px solid #f1f5f9; transition:background 0.15s; }
    .ac-item:last-child { border-bottom:none; }
    .ac-item:hover, .ac-item.active { background:#f8fafc; }
    .ac-item .name { font-weight:600; color:#0f172a; }
    .ac-item .city { color:#64748b; font-size:12px; }
    .chip { display:inline-flex; align-items:center; gap:8px; padding:10px 18px; border:2px solid #e2e8f0; border-radius:999px; background:#fff; cursor:pointer; user-select:none; font-size:14px; transition:all 0.3s; font-weight:500; }
    .chip input[type="radio"], .chip input[type="checkbox"] { display:none; }
    .chip:has(input:checked) { border-color:#667eea; background:linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); color:#667eea; font-weight:600; box-shadow:0 2px 8px rgba(102,126,234,0.2); }
    .chip:hover { background:#f8fafc; border-color:#cbd5e1; transform:translateY(-1px); }

    /* Main Layout: Full Screen Map with Floating Cards */
    .map-container { width:100%; height:100%; position: relative; }
    #map { width:100%; height:100%; }
    
    /* Floating Search Card - Google Maps Style */
    .search-card-float { position:absolute; top:84px; left:20px; width:420px; background:#fff; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.12); z-index:1100; padding:24px; max-height:calc(100vh - 104px); overflow-y:auto; display:flex; flex-direction:column; }
    .search-card-float::-webkit-scrollbar { width:6px; }
    .search-card-float::[REDACTED] { background:transparent; }
    .search-card-float::[REDACTED] { background:#cbd5e1; border-radius:10px; }
    
    /* Results Panel - Slides from bottom on mobile, right side on desktop */
    .results-panel { position:absolute; top:84px; right:20px; width:400px; background:#fff; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.12); z-index:1200; padding:24px; max-height:calc(100vh - 104px); overflow-y:auto; display:none; flex-direction:column; }
    .results-panel.active { display:block; animation:slideInRight 0.3s ease-out; }
    @keyframes slideInRight { from { transform:translateX(100%); opacity:0; } to { transform:translateX(0); opacity:1; } }

    .search-input { width:100%; padding:16px 18px; border:2px solid #e2e8f0; border-radius:14px; font-size:15px; transition:all 0.3s; background:#fff; }
    .search-input:focus { outline:none; border-color:#667eea; box-shadow:0 0 0 4px rgba(102,126,234,0.15); background:#fff; }
    .search-input:hover { border-color:#cbd5e1; }
    
    /* Side Panel Content */
    .panel-content { flex-grow:1; overflow-y:auto; padding:20px; min-height: 0; }
    .section { background:#fff; border:1px solid #e2e8f0; border-radius:16px; padding:20px; box-shadow:0 4px 12px rgba(15,23,42,0.08); }
    #results { margin:0; padding:0; }
    .input-group { margin-bottom:12px; }
    .input-group label { display:block; margin-bottom:6px; font-weight:600; color:#475569; font-size:13px; }
    .section h3 { margin:0 0 12px 0; font-size:16px; font-weight:700; color:#0f172a; }
    .muted { color:#64748b; font-size:13px; }
    .trip { border:1px solid #e2e8f0; border-radius:16px; padding:16px; background:#fff; box-shadow:0 2px 8px rgba(15,23,42,0.06); margin-bottom:10px; transition:all 0.3s; }
    .trip:hover { box-shadow:0 8px 24px rgba(15,23,42,0.12); transform:translateY(-2px); border-color:#cbd5e1; }
    .trip:last-child { margin-bottom:0; }
    .trip .header { display:flex; align-items:center; gap:10px; margin-bottom:8px; font-size:15px; }
    .trip .header strong { color:#0f172a; }
    .trip .route-info { font-size:14px; color:#334155; margin-bottom:6px; }
    .trip .time-info { display:flex; gap:16px; font-size:13px; color:#64748b; margin-top:8px; }
    .trip .fare-badge { display:inline-block; background:linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%); color:#059669; padding:6px 12px; border-radius:8px; font-weight:700; font-size:13px; box-shadow:0 2px 4px rgba(5,150,105,0.1); }
    .icon { font-size:20px; width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; }

    /* Progressive Options */
    .options-container { margin-top:20px; opacity:0; max-height:0; overflow:hidden; transition:all 0.3s ease; }
    .options-container.visible { opacity:1; max-height:500px; }
    .hotel-list { display:grid; [REDACTED]:1fr; gap:10px; }
    .hotel-card { background:#fff; border:1px solid #e2e8f0; border-radius:10px; padding:12px; display:flex; align-items:center; justify-content:space-between; transition:box-shadow 0.2s; }
    .hotel-card:hover { box-shadow:0 4px 8px rgba(15,23,42,0.08); }
    .hotel-card .name { font-weight:700; color:#0f172a; }
    .hotel-card .price { color:#3b82f6; font-weight:700; font-size:15px; }

    /* Navigation */
    .nav-controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
    .nav-controls button { padding:9px 14px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; cursor:pointer; font-weight:600; font-size:13px; transition:all 0.2s; }
    .nav-controls button:hover { background:#f8fafc; border-color:#94a3b8; }
    .nav-controls .primary { background:#10b981; color:#fff; border:none; }
    .nav-controls .primary:hover { background:#059669; }
    .nav-controls .danger { background:#ef4444; color:#fff; border:none; }
    .nav-controls .danger:hover { background:#dc2626; }
    .nav-controls .info { color:#64748b; font-size:13px; font-weight:500; }
    .instructions { background:#fafafa; border-radius:10px; padding:12px; }
    .instructions h4 { margin:0 0 10px 0; font-size:14px; font-weight:700; color:#0f172a; }
    .instructions .step { padding:10px 8px; border-bottom:1px solid #e2e8f0; font-size:14px; display:flex; align-items:center; gap:10px; transition:background 0.2s; }
    .instructions .step:last-child { border-bottom:none; }
    .instructions .step:hover { background:#f1f5f9; }
    .instructions .step .icon { font-size:18px; }

    /* Modal */
    .modal { position:fixed; inset:0; background:rgba(2,6,23,0.5); display:none; align-items:center; justify-content:center; z-index:2000; backdrop-filter:blur(4px); }
    .modal .card { width:360px; background:#fff; border-radius:16px; padding:20px; box-shadow:0 20px 50px rgba(2,6,23,0.3); }
    .modal .row { margin-bottom:14px; }
    .modal .row label { display:block; margin-bottom:6px; font-weight:600; color:#334155; font-size:13px; }
    .modal .row input[type="date"], .modal .row input[type="range"] { width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:10px; font-size:14px; }
    .modal .actions { display:flex; justify-content:flex-end; gap:10px; margin-top:16px; }
    .summary-bar { display:flex; justify-content:space-between; align-items:center; padding:12px; background:#f8fafc; border-radius:10px; margin-bottom:12px; }
    .summary-bar .item { display:flex; flex-direction:column; gap:4px; }
    .summary-bar .label { font-size:12px; color:#64748b; font-weight:500; }
    .summary-bar .value { font-size:18px; font-weight:700; color:#0f172a; }

    /* Mode row */
    .mode-row { grid-column:1 / -1; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .vehicle-row { grid-column:1 / -1; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .vehicle-row .label { color:#475569; font-size:14px; font-weight:500; }

    /* Loading overlay */
    .loading-overlay { position:fixed; inset:0; background:rgba(255,255,255,0.95); display:none; align-items:center; justify-content:center; z-index:3000; backdrop-filter:blur(8px); }
    .loading-overlay.active { display:flex; }
    
    /* Error Toast */
    .error-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ef4444;
      color: white;
      padding: 16px 24px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
      z-index: 4000;
      display: none;
      animation: slideIn 0.3s ease-out;
      max-width: 400px;
    }
    .error-toast.show { display: block; }
    @keyframes slideIn {
      from { transform: translateX(400px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .loader { position:relative; width:80px; height:80px; }
    .loader-ring { position:absolute; width:100%; height:100%; border:4px solid transparent; border-top-color:#667eea; border-radius:50%; animation:spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; }
    .loader-ring:nth-child(1) { animation-delay:-0.45s; border-top-color:#764ba2; }
    .loader-ring:nth-child(2) { animation-delay:-0.3s; border-top-color:#f093fb; }
    .loader-ring:nth-child(3) { animation-delay:-0.15s; border-top-color:#667eea; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    
    /* Google Maps Style Floating Search Card */
    .search-card { background:#fff; border-radius:16px; box-shadow:0 4px 20px rgba(15,23,42,0.1); padding:24px; margin-bottom:20px; }
    .search-card-title { font-size:18px; font-weight:700; color:#0f172a; margin-bottom:16px; display:flex; align-items:center; gap:10px; }
    .search-card-title .emoji { font-size:24px; }
    
    /* Smooth Animations */
    @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
    .fade-in { animation:fadeIn 0.4s ease-out; }
    
    /* Better Scrollbar */
    .panel-content::-webkit-scrollbar { width:8px; }
    .panel-content::[REDACTED] { background:#f1f5f9; border-radius:10px; }
    .panel-content::[REDACTED] { background:#cbd5e1; border-radius:10px; }
    .panel-content::[REDACTED]:hover { background:#94a3b8; }
    .loader-text { position:absolute; top:110%; left:50%; transform:translateX(-50%); white-space:nowrap; color:#475569; font-weight:600; font-size:14px; animation:pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity:0.6; } 50% { opacity:1; } }

    /* Micro-interactions and Visual Enhancements */
    .action-btn, .ghost-btn, .chip {
      position: relative;
      overflow: hidden;
    }
    .action-btn::before, .ghost-btn::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }
    .action-btn:active::before, .ghost-btn:active::before {
      width: 300px;
      height: 300px;
    }
    
    /* Smooth hover effects */
    .trip, .hotel-card, .section {
      transform: translateY(0);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .trip:hover, .hotel-card:hover {
      transform: translateY(-4px);
    }
    
    /* Success celebration */
    @keyframes celebrate {
      0%, 100% { transform: scale(1) rotate(0deg); }
      25% { transform: scale(1.1) rotate(-5deg); }
      75% { transform: scale(1.1) rotate(5deg); }
    }
    .celebrate {
      animation: celebrate 0.5s ease-in-out;
    }
    
    /* Error shake */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }
    .shake {
      animation: shake 0.5s ease-in-out;
    }
    
    /* Smooth transitions */
    * {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    
    /* Fade-in animations */
    @keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
    .section { animation:fadeInUp 0.4s ease-out; }
    .trip { animation:fadeInUp 0.3s ease-out; }
    .trip:nth-child(1) { animation-delay:0.05s; }
    .trip:nth-child(2) { animation-delay:0.1s; }
    .trip:nth-child(3) { animation-delay:0.15s; }
    .trip:nth-child(4) { animation-delay:0.2s; }

    /* Success checkmark animation */
    @keyframes checkmark { 0% { stroke-dashoffset:100; } 100% { stroke-dashoffset:0; } }
    .success-icon { width:60px; height:60px; margin:0 auto 16px; }
    .success-icon circle { fill:#10b981; }
    .success-icon path { stroke:#fff; stroke-width:3; stroke-dasharray:100; stroke-dashoffset:100; animation:checkmark 0.6s ease-out 0.3s forwards; }

    /* Recent searches */
    .recent-searches { grid-column:1 / -1; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .recent-searches .label { color:#64748b; font-size:13px; font-weight:500; }
    .recent-chip { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border:1px solid #e2e8f0; border-radius:999px; background:#fff; cursor:pointer; font-size:13px; transition:all 0.2s; }
    .recent-chip:hover { background:#f8fafc; border-color:#cbd5e1; }
    .recent-chip .clear { margin-left:4px; color:#94a3b8; font-weight:700; }
    .recent-chip .clear:hover { color:#ef4444; }

    /* Compare mode */
    .compare-grid { display:grid; [REDACTED]:1fr 1fr; gap:12px; }
    .compare-card { border:2px solid #e2e8f0; border-radius:14px; padding:16px; background:#fff; position:relative; transition:all 0.3s; }
    .compare-card:hover { border-color:#667eea; box-shadow:0 8px 16px rgba(102,126,234,0.15); transform:translateY(-2px); }
    .compare-card.recommended { border-color:#10b981; background:linear-gradient(135deg,#ecfdf5,#f0fdf4); }
    .compare-card .badge { position:absolute; top:-10px; right:12px; background:#10b981; color:#fff; padding:4px 10px; border-radius:999px; font-size:11px; font-weight:700; box-shadow:0 2px 8px rgba(16,185,129,0.3); }
    .compare-card .choose-btn { width:100%; margin-top:12px; padding:10px; border:none; border-radius:8px; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:#fff; font-weight:600; cursor:pointer; transition:all 0.3s; }
    .compare-card .choose-btn:hover { transform:translateY(-2px); box-shadow:0 4px 12px rgba(102,126,234,0.3); }
    .compare-card.recommended .choose-btn { background:linear-gradient(135deg, #10b981 0%, #059669 100%); }

    /* Responsive - Mobile Optimization */
    @media (max-width: 768px) {
      .top-bar { height:56px; padding:0 16px; }
      .brand-text { font-size:20px; }
      .top-bar-actions { gap:8px; }
      .search-card-float { 
        top:72px; 
        left:12px; 
        right:12px; 
        width:auto; 
        max-height:calc(100vh - 88px);
      }
      .results-panel {
        top:auto;
        bottom:0;
        left:0;
        right:0;
        width:100%;
        border-radius:16px 16px 0 0;
        max-height:70vh;
        order: 2;
      }
      .panel-content { 
        max-height: 40vh;
      }
      .header {
        padding: 12px 16px;
      }
      .brand {
        font-size: 20px;
      }
      .search-input {
        font-size: 16px; /* Prevents zoom on iOS */
      }
      .chip {
        font-size: 13px;
        padding: 6px 12px;
      }
    }
    
    @media (max-width: 480px) {
      .side-panel {
        max-height: 60vh;
      }
      .map-container {
        height: 40vh;
      }
      .action-btn {
        padding: 12px;
        font-size: 15px;
      }
    }
    
    /* Leaflet controls offset to avoid floating cards */
    .leaflet-top.leaflet-left { top: 120px; left: 16px; }
    @media (max-width: 768px) {
      .leaflet-top.leaflet-left { top: 132px; left: 12px; }
    }
    
    /* When results are open on desktop, make room on the right */
    @media (min-width: 1024px) {
      body.results-open .search-card-float { right: calc(400px + 40px); max-width: calc(100vw - 400px - 80px); }
      body.results-open .leaflet-bottom.leaflet-right { right: 440px; }
    }
  </style>
</head>
<body>
  <div id="app">

    <!-- Time Picker Modal -->
    <div id="timeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="timePickerTitle" style="display:none;">
      <div class="card">
        <div class="row"><h4 id="timePickerTitle" style="margin:0; font-size:18px; color:#0f172a;">üïê When do you want to arrive?</h4></div>
        <div class="row">
          <label for="dateInput">Date</label>
          <input id="dateInput" type="date" />
        </div>
        <div class="row">
          <label for="customTime">Arrival Time</label>
          <input id="customTime" type="time" value="17:00" style="width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 14px;" />
          <div class="muted" style="margin-top: 8px; font-size: 12px; color: #64748b;">
            üí° <strong>Traffic Tips:</strong>
            <span style="color:#ef4444;">7-10 AM & 5-8 PM</span> = Rush Hour |
            <span style="color:#f59e0b;">12-2 PM</span> = Busy |
            <span style="color:#10b981;">Other times</span> = Clear
          </div>
        </div>
        <div class="actions">
          <button id="cancelTimeBtn" class="ghost-btn" type="button">Leave now</button>
          <button id="confirmTimeBtn" class="action-btn" type="button">Set time</button>
        </div>
      </div>
    </div>

    <!-- Loading overlay with AI taglines -->
    <div id="loadingOverlay" class="loading-overlay">
      <div style="text-align: center;">
        <div class="loader">
          <div class="loader-ring"></div>
          <div class="loader-ring"></div>
          <div class="loader-ring"></div>
        </div>
        <div class="loader-text" id="loadingText">ü§ñ AI is analyzing 45,000 stations...</div>
        <div style="margin-top: 20px; width: 300px;">
          <div style="width: 100%; height: 4px; background: #e2e8f0; border-radius: 2px; overflow: hidden; margin: 10px auto;">
            <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3b82f6, #06b6d4); transition: width 0.5s ease-out;"></div>
          </div>
          <div id="progressText" style="font-size: 12px; color: #64748b; margin-top: 8px;">Initializing...</div>
        </div>
      </div>
    </div>

    <!-- Minimal Top Bar -->
    <div class="top-bar">
      <div class="brand">
        <div class="logo">üöÄ</div>
        <div class="brand-text">Velora</div>
      </div>
      <div class="top-bar-actions">
        <!-- Actions removed for cleaner UI -->
      </div>
    </div>

    <!-- Full Screen Map -->
    <div class="map-container">
      <div id="map"></div>
      
      <!-- Floating Search Card -->
      <div class="search-card-float" id="searchCard">
        <div style="margin-bottom:20px;">
          <h2 style="margin:0 0 8px 0; font-size:24px; font-weight:700; color:#0f172a;">Plan Your Journey</h2>
          <p style="margin:0; color:#64748b; font-size:14px;">Find the best route across India üáÆüá≥</p>
        </div>
        
        <div id=[REDACTED]>
          <div class="input-group">
            <label for="originInput">üìç From</label>
            <div class="ac-wrap">
              <input id="originInput" class="search-input" type="text" placeholder="Enter starting location" autocomplete="off" />
              <input id="originId" type="hidden" />
              <div id="originList" class="ac-list" style="display:none;"></div>
            </div>
          </div>
          <div class="input-group">
            <label for="destInput">üéØ To</label>
            <div class="ac-wrap">
              <input id="destInput" class="search-input" type="text" placeholder="Enter destination" autocomplete="off" />
              <input id="destId" type="hidden" />
              <div id="destList" class="ac-list" style="display:none;"></div>
            </div>
          </div>
          <div class="options-container" id="optionsContainer">
            <div style="margin-bottom:12px;">
              <label style="display:block; margin-bottom:8px; font-weight:600; color:#475569; font-size:13px;">üöÄ Choose Transport (Select Multiple)</label>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <div class="chip"><input type="checkbox" name="modeChoice" id="modeBus" value="bus" checked /><label for="modeBus" class="chip-label"><span class="emoji">üöå</span> Bus</label></div>
                <div class="chip"><input type="checkbox" name="modeChoice" id="modeTrain" value="train" /><label for="modeTrain" class="chip-label"><span class="emoji">üöÇ</span> Train</label></div>
                <div class="chip"><input type="checkbox" name="modeChoice" id="modeFlight" value="flight" /><label for="modeFlight" class="chip-label"><span class="emoji">‚úàÔ∏è</span> Flight</label></div>
                <div class="chip"><input type="checkbox" name="modeChoice" id="modeDrive" value="drive" /><label for="modeDrive" class="chip-label"><span class="emoji">üöó</span> Drive</label></div>
              </div>
            </div>
            <button id="selectTimeBtn" class="ghost-btn" type="button" style="width:100%; margin-bottom:8px;">üïê Set Arrival Time (Optional)</button>
            <span id="selectedTimeText" class="muted" style="text-align:center; display:block; margin-bottom:12px; font-size:12px;">‚è∞ Leaving now</span>
          </div>
          <button id="planBtn" class="action-btn" disabled style="width:100%; padding:14px; font-size:16px;">‚ú® Find My Route</button>
          <input id="arriveBy" type="hidden" value="23:59:59" />
          <input id="planDate" type="hidden" />
          <div id="vehicleGroup" style="display:none;">
            <input type="radio" name="vehChoice" id="vehicleYes" value="yes" />
            <input type="radio" name="vehChoice" id="vehicleNo" value="no" checked />
          </div>
        </div>

        <!-- Results View (initially hidden) -->
        <div id=[REDACTED] style="display: none;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:16px;">
                <h2 style="margin:0; font-size:20px; color:#0f172a;">üó∫Ô∏è Your Route</h2>
                <button id="startOverBtn" class="ghost-btn" style="padding: 8px 12px; font-size: 13px;">üîÑ New Search</button>
            </div>
            <div id="summarySection" style="display:none; margin-bottom:16px;">
                <div style="background:#f8fafc; border-radius:12px; padding:16px;">
                    <div style="display:grid; [REDACTED]:repeat(2,1fr); gap:12px;">
                        <div style="text-align:center;"><div style="font-size:12px; color:#64748b; margin-bottom:4px;">Duration</div><div id="totalTime" style="font-size:18px; font-weight:700;">-</div></div>
                        <div style="text-align:center;"><div style="font-size:12px; color:#64748b; margin-bottom:4px;">Fare</div><div id="totalFare" style="font-size:18px; font-weight:700;">‚Çπ-</div></div>
                    </div>
                    <div id="decisionLabel" style="margin-top:12px; padding:8px; background:#ecfdf5; color:#059669; border-radius:8px; text-align:center; font-weight:600; font-size:13px;"></div>
                </div>
            </div>
        </div>
      </div>
      
      <!-- Results Panel (Floating on Right) -->
      <div class="results-panel" id="resultsPanel">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
          <h2 style="margin:0; font-size:20px; font-weight:700; color:#0f172a;">Your Route</h2>
          <button id="closeResults" class="ghost-btn" style="padding:8px 12px; font-size:13px;">‚úï Close</button>
        </div>
        
        <div id="results"><div class="muted" style="text-align:center; padding:20px;">Results will appear here.</div></div>
        
        <button id="hotelsBtn" class="action-btn" style="width:100%; margin-top:16px; display:none;">üè® Find Nearby Hotels</button>
        <div id="hotelsPanel" style="display:none; margin-top:16px;">
          <h3 style="font-size:18px; font-weight:700; margin-bottom:12px;">üè® Nearby Hotels</h3>
          <div id="hotelList" class="hotel-list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error Toast -->
  <div id="errorToast" class="error-toast"></div>

  <script>const CACHE_V = Math.random().toString(36).substring(7);</script>
  <script>
    // Global error handler
    window.showError = function(message) {
      const toast = document.getElementById('errorToast');
      if (toast) {
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 5000);
      }
    };
    
    // Catch unhandled errors
    window.addEventListener('error', (e) => {
      console.error('Global error:', e);
      showError('An unexpected error occurred. Please try again.');
    });
    
    window.addEventListener('unhandledrejection', (e) => {
      console.error('Unhandled promise:', e);
      showError('Network error. Please check your connection.');
    });
    
    // Handle results panel visibility
    document.getElementById('closeResults')?.addEventListener('click', () => {
      const panel = document.getElementById('resultsPanel');
      panel.classList.remove('active');
      document.body.classList.remove('results-open');
    });
    
    // Show results panel when results are displayed
    const originalResultsDiv = document.getElementById('results');
    if (originalResultsDiv) {
      const observer = new MutationObserver(() => {
        const text = (originalResultsDiv.textContent || '').trim();
        const hasContent = originalResultsDiv.children.length > 0 && !/Results will appear here\./i.test(text);
        const panel = document.getElementById('resultsPanel');
        if (hasContent) {
          panel.classList.add('active');
          document.body.classList.add('results-open');
        } else {
          panel.classList.remove('active');
          document.body.classList.remove('results-open');
        }
      });
      observer.observe(originalResultsDiv, { childList: true, subtree: true, characterData: true });
    }
    
    document.addEventListener('DOMContentLoaded', () => {
      const originInput = document.getElementById('originInput');
      const destInput = document.getElementById('destInput');
      const optionsContainer = document.getElementById('optionsContainer');
      const checkInputs = () => optionsContainer.classList.toggle('visible', originInput.value.trim() && destInput.value.trim());
      originInput.addEventListener('input', checkInputs);
      destInput.addEventListener('input', checkInputs);

      const searchFormContainer = document.getElementById([REDACTED]);
      const [REDACTED] = document.getElementById([REDACTED]);
      const startOverBtn = document.getElementById('startOverBtn');
      const hotelsBtn = document.getElementById('hotelsBtn');
      const hotelsPanel = document.getElementById('hotelsPanel');

      // Switch between Search and Results views
      const resultsObserver = new MutationObserver(() => {
        const results = document.getElementById('results');
        if (results && results.children.length > 0 && !results.textContent.includes('Plan a route')) {
            searchFormContainer.style.display = 'none';
            [REDACTED].style.display = 'block';
            if (hotelsBtn) hotelsBtn.style.display = 'block';
        }
      });
      
      const results = document.getElementById('results');
      if (results) resultsObserver.observe(results, { childList: true, subtree: true });

      // Start Over button
      startOverBtn.addEventListener('click', () => {
        // Instead of reloading, just reset the UI state
        [REDACTED].style.display = 'none';
        searchFormContainer.style.display = 'block';
        document.getElementById('results').innerHTML = '';
        document.getElementById('summarySection').style.display = 'none';
        hotelsBtn.style.display = 'none';
        hotelsPanel.style.display = 'none';
        document.getElementById('originInput').focus();
        // You might want to clear map layers here as well
      });
      
      // Hotels button - Load hotels for destination
      hotelsBtn.addEventListener('click', async () => {
        hotelsBtn.style.display = 'none';
        hotelsPanel.style.display = 'block';
        
        // Get destination coordinates
        const destInput = document.getElementById('destInput');
        const destLat = destInput?.dataset?.lat;
        const destLon = destInput?.dataset?.lon;
        
        if (destLat && destLon) {
          try {
            const hotelList = document.getElementById('hotelList');
            hotelList.innerHTML = '<div style="text-align:center; padding:20px; color:#64748b;">Loading hotels...</div>';
            
            // Call hotels API
            const apiBase = window.VELORA_CONFIG?.API_BASE || '';
            const url = `${apiBase}/get_hotels.php?lat=${destLat}&lon=${destLon}`;
            const response = await fetch(url);
            const data = await response.json();
            
            if (data && data.data && data.data.length > 0) {
              hotelList.innerHTML = data.data.map(hotel => `
                <div class="hotel-card">
                  <div>
                    <div class="name">${hotel.hotel_name || hotel.name || 'Hotel'}</div>
                    <div style="font-size:12px; color:#64748b;">${hotel.city || ''} ${hotel.stars ? '‚≠ê'.repeat(hotel.stars) : ''}</div>
                  </div>
                  <div class="price">‚Çπ${hotel.price_per_night || hotel.price || '2000'}/night</div>
                </div>
              `).join('');
            } else {
              hotelList.innerHTML = '<div style="text-align:center; padding:20px; color:#64748b;">No hotels found nearby</div>';
            }
          } catch (error) {
            console.error('Hotels error:', error);
            document.getElementById('hotelList').innerHTML = '<div style="text-align:center; padding:20px; color:#ef4444;">Failed to load hotels</div>';
          }
        } else {
          document.getElementById('hotelList').innerHTML = '<div style="text-align:center; padding:20px; color:#64748b;">Destination coordinates not available</div>';
        }
      });
    });
  </script>
  <script>document.write('<script src="./api.config.js?v=' + CACHE_V + '"><\/script>');</script>
  <script src="https://unpkg.com/[REDACTED]/dist/leaflet.js" crossorigin=""></script>
  <script>document.write('<script src="./weather.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./cost_breakdown.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./emergency.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./smart_notifications.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./route_reviews.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./multi_stop.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./comparison_charts.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./smart_ai.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./comparison_engine.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./comparison_ui.js?v=' + CACHE_V + '"><\/script>');</script>
  <script>document.write('<script src="./transit.js?v=' + CACHE_V + '"><\/script>');</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
  <script>
    // Auto-detect base path based on current URL
    const basePath = window.location.pathname.includes('/frontend/') ? '..' : '';
    window.VELORA_CONFIG = { API_BASE: basePath };
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Velora ‚Äî AI Transit Planner for India</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; }
    body { font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:#0f172a; background:#f8fafc; }
    #app { display:grid; grid-template-rows:auto 1fr; height:100%; }

    /* Topbar */
    .topbar { display:grid; grid-template-columns:auto 1fr 1fr auto auto; gap:12px; padding:16px 20px; background:#ffffff; border-bottom:1px solid #e2e8f0; align-items:center; box-shadow:0 1px 3px rgba(15,23,42,0.04); }
    .brand { display:flex; align-items:center; gap:10px; font-weight:800; font-size:20px; color:#0f172a; white-space:nowrap; }
    .brand .logo { width:32px; height:32px; border-radius:10px; background:linear-gradient(135deg,#6366f1,#06b6d4); display:inline-flex; align-items:center; justify-content:center; color:#fff; font-size:18px; }
    .ac-wrap { position:relative; }
    .ac-input { width:100%; padding:11px 14px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; font-size:14px; transition:all 0.2s; }
    .ac-input:focus { outline:none; border-color:#6366f1; box-shadow:0 0 0 3px #eef2ff; }
    .action-btn { padding:11px 18px; border-radius:10px; border:none; background:#6366f1; color:#fff; font-weight:600; cursor:pointer; font-size:14px; transition:all 0.2s; }
    .action-btn:hover { background:#4f46e5; }
    .action-btn:disabled { background:#c7d2fe; cursor:not-allowed; }
    .ghost-btn { padding:10px 14px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; color:#475569; cursor:pointer; font-size:14px; transition:all 0.2s; }
    .ghost-btn:hover { background:#f8fafc; border-color:#94a3b8; }
    .form-msg { grid-column:1 / -1; color:#dc2626; font-size:13px; font-weight:500; }
    .ac-list { position:absolute; top:calc(100% + 4px); left:0; right:0; background:#fff; border:1px solid #e2e8f0; border-radius:12px; max-height:280px; overflow:auto; z-index:1000; box-shadow:0 10px 30px rgba(15,23,42,0.12); }
    .ac-item { padding:12px 14px; display:flex; justify-content:space-between; cursor:pointer; border-bottom:1px solid #f1f5f9; transition:background 0.15s; }
    .ac-item:last-child { border-bottom:none; }
    .ac-item:hover, .ac-item.active { background:#f8fafc; }
    .ac-item .name { font-weight:600; color:#0f172a; }
    .ac-item .city { color:#64748b; font-size:12px; }
    .chip { display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border:1px solid #e2e8f0; border-radius:999px; background:#fff; cursor:pointer; user-select:none; font-size:14px; transition:all 0.2s; }
    .chip input { display:none; }
    .chip.active { border-color:#6366f1; background:#eef2ff; color:#4f46e5; font-weight:600; }
    .chip:hover:not(.active) { background:#f8fafc; border-color:#cbd5e1; }

    /* Content */
    .content { display:grid; grid-template-columns:2fr 1fr; height:100%; }
    #map { width:100%; height:100%; }
    .panel { border-left:1px solid #e2e8f0; padding:16px; overflow:auto; background:#f8fafc; display:flex; flex-direction:column; gap:16px; }
    .section { background:#fff; border:1px solid #e2e8f0; border-radius:14px; padding:16px; box-shadow:0 1px 3px rgba(15,23,42,0.06); }
    .section h3 { margin:0 0 12px 0; font-size:16px; font-weight:700; color:#0f172a; }
    .muted { color:#64748b; font-size:13px; }
    .trip { border:1px solid #e2e8f0; border-radius:12px; padding:14px; background:#fff; box-shadow:0 1px 2px rgba(15,23,42,0.04); margin-bottom:10px; transition:box-shadow 0.2s; }
    .trip:hover { box-shadow:0 4px 8px rgba(15,23,42,0.08); }
    .trip .header { display:flex; align-items:center; gap:10px; margin-bottom:8px; font-size:15px; }
    .trip .header strong { color:#0f172a; }
    .trip .route-info { font-size:14px; color:#334155; margin-bottom:6px; }
    .trip .time-info { display:flex; gap:16px; font-size:13px; color:#64748b; margin-top:8px; }
    .trip .fare-badge { display:inline-block; background:#ecfdf5; color:#059669; padding:4px 10px; border-radius:6px; font-weight:600; font-size:13px; }
    .icon { font-size:20px; width:24px; height:24px; display:inline-flex; align-items:center; justify-content:center; }
    .hotel-list { display:grid; grid-template-columns:1fr; gap:10px; }
    .hotel-card { background:#fff; border:1px solid #e2e8f0; border-radius:10px; padding:12px; display:flex; align-items:center; justify-content:space-between; transition:box-shadow 0.2s; }
    .hotel-card:hover { box-shadow:0 4px 8px rgba(15,23,42,0.08); }
    .hotel-card .name { font-weight:700; color:#0f172a; }
    .hotel-card .price { color:#6366f1; font-weight:700; font-size:15px; }

    /* Navigation */
    .nav-controls { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:12px; }
    .nav-controls button { padding:9px 14px; border:1px solid #cbd5e1; border-radius:10px; background:#fff; cursor:pointer; font-weight:600; font-size:13px; transition:all 0.2s; }
    .nav-controls button:hover { background:#f8fafc; border-color:#94a3b8; }
    .nav-controls .primary { background:#10b981; color:#fff; border:none; }
    .nav-controls .primary:hover { background:#059669; }
    .nav-controls .danger { background:#ef4444; color:#fff; border:none; }
    .nav-controls .danger:hover { background:#dc2626; }
    .nav-controls .info { color:#64748b; font-size:13px; font-weight:500; }
    .instructions { background:#fafafa; border-radius:10px; padding:12px; }
    .instructions h4 { margin:0 0 10px 0; font-size:14px; font-weight:700; color:#0f172a; }
    .instructions .step { padding:10px 8px; border-bottom:1px solid #e2e8f0; font-size:14px; display:flex; align-items:center; gap:10px; transition:background 0.2s; }
    .instructions .step:last-child { border-bottom:none; }
    .instructions .step:hover { background:#f1f5f9; }
    .instructions .step .icon { font-size:18px; }

    /* Modal */
    .modal { position:fixed; inset:0; background:rgba(2,6,23,0.5); display:none; align-items:center; justify-content:center; z-index:2000; backdrop-filter:blur(4px); }
    .modal .card { width:360px; background:#fff; border-radius:16px; padding:20px; box-shadow:0 20px 50px rgba(2,6,23,0.3); }
    .modal .row { margin-bottom:14px; }
    .modal .row label { display:block; margin-bottom:6px; font-weight:600; color:#334155; font-size:13px; }
    .modal .row input[type="date"], .modal .row input[type="range"] { width:100%; padding:10px; border:1px solid #cbd5e1; border-radius:10px; font-size:14px; }
    .modal .actions { display:flex; justify-content:flex-end; gap:10px; margin-top:16px; }
    .summary-bar { display:flex; justify-content:space-between; align-items:center; padding:12px; background:#f8fafc; border-radius:10px; margin-bottom:12px; }
    .summary-bar .item { display:flex; flex-direction:column; gap:4px; }
    .summary-bar .label { font-size:12px; color:#64748b; font-weight:500; }
    .summary-bar .value { font-size:18px; font-weight:700; color:#0f172a; }

    /* Mode row */
    .mode-row { grid-column:1 / -1; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .vehicle-row { grid-column:1 / -1; display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .vehicle-row .label { color:#475569; font-size:14px; font-weight:500; }

    /* Loading overlay */
    .loading-overlay { position:fixed; inset:0; background:rgba(255,255,255,0.95); display:none; align-items:center; justify-content:center; z-index:3000; backdrop-filter:blur(8px); }
    .loading-overlay.active { display:flex; }
    .loader { position:relative; width:80px; height:80px; }
    .loader-ring { position:absolute; width:100%; height:100%; border:4px solid transparent; border-top-color:#6366f1; border-radius:50%; animation:spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; }
    .loader-ring:nth-child(1) { animation-delay:-0.45s; border-top-color:#06b6d4; }
    .loader-ring:nth-child(2) { animation-delay:-0.3s; border-top-color:#8b5cf6; }
    .loader-ring:nth-child(3) { animation-delay:-0.15s; border-top-color:#ec4899; }
    @keyframes spin { 0% { transform:rotate(0deg); } 100% { transform:rotate(360deg); } }
    .loader-text { position:absolute; top:110%; left:50%; transform:translateX(-50%); white-space:nowrap; color:#475569; font-weight:600; font-size:14px; animation:pulse 1.5s ease-in-out infinite; }
    @keyframes pulse { 0%, 100% { opacity:0.6; } 50% { opacity:1; } }

    /* Fade-in animations */
    @keyframes fadeInUp { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }
    @keyframes fadeIn { from { opacity:0; } to { opacity:1; } }
    .section { animation:fadeInUp 0.4s ease-out; }
    .trip { animation:fadeInUp 0.3s ease-out; }
    .trip:nth-child(1) { animation-delay:0.05s; }
    .trip:nth-child(2) { animation-delay:0.1s; }
    .trip:nth-child(3) { animation-delay:0.15s; }
    .trip:nth-child(4) { animation-delay:0.2s; }

    /* Success checkmark animation */
    @keyframes checkmark { 0% { stroke-dashoffset:100; } 100% { stroke-dashoffset:0; } }
    .success-icon { width:60px; height:60px; margin:0 auto 16px; }
    .success-icon circle { fill:#10b981; }
    .success-icon path { stroke:#fff; stroke-width:3; stroke-dasharray:100; stroke-dashoffset:100; animation:checkmark 0.6s ease-out 0.3s forwards; }

    /* Recent searches */
    .recent-searches { grid-column:1 / -1; display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .recent-searches .label { color:#64748b; font-size:13px; font-weight:500; }
    .recent-chip { display:inline-flex; align-items:center; gap:6px; padding:6px 12px; border:1px solid #e2e8f0; border-radius:999px; background:#fff; cursor:pointer; font-size:13px; transition:all 0.2s; }
    .recent-chip:hover { background:#f8fafc; border-color:#cbd5e1; }
    .recent-chip .clear { margin-left:4px; color:#94a3b8; font-weight:700; }
    .recent-chip .clear:hover { color:#ef4444; }

    /* Compare mode */
    .compare-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    .compare-card { border:2px solid #e2e8f0; border-radius:14px; padding:16px; background:#fff; position:relative; transition:all 0.3s; }
    .compare-card:hover { border-color:#6366f1; box-shadow:0 8px 16px rgba(99,102,241,0.15); }
    .compare-card.recommended { border-color:#10b981; background:linear-gradient(135deg,#ecfdf5,#f0fdf4); }
    .compare-card .badge { position:absolute; top:-10px; right:12px; background:#10b981; color:#fff; padding:4px 10px; border-radius:999px; font-size:11px; font-weight:700; }
    .compare-card .choose-btn { width:100%; margin-top:12px; padding:10px; border:none; border-radius:8px; background:#6366f1; color:#fff; font-weight:600; cursor:pointer; }
    .compare-card.recommended .choose-btn { background:#10b981; }

    /* Responsive */
    @media (max-width: 1024px) {
      .content { grid-template-columns:1fr; grid-template-rows:50vh 1fr; }
      .topbar { grid-template-columns:1fr; }
      .brand { grid-column:1 / -1; }
      .compare-grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="topbar">
      <div class="brand"><span class="logo">üåç</span> Velora</div>
      <div class="ac-wrap">
        <input id="originInput" class="ac-input" type="text" placeholder="üîç From: City, station, or place" autocomplete="off" />
        <input id="originId" type="hidden" />
        <div id="originList" class="ac-list" style="display:none;"></div>
      </div>
      <div class="ac-wrap">
        <input id="destInput" class="ac-input" type="text" placeholder="üìç To: City, station, or place" autocomplete="off" />
        <input id="destId" type="hidden" />
        <div id="destList" class="ac-list" style="display:none;"></div>
      </div>
      <button id="selectTimeBtn" class="ghost-btn" type="button">üïê Time</button>
      <button id="compareBtn" class="ghost-btn" type="button" style="display:none;">‚öñÔ∏è Compare</button>
      <button id="planBtn" class="action-btn" disabled>Plan Trip</button>
      <div class="mode-row">
        <div class="chip" id="chipVelora"><input type="radio" name="modeChoice" id="modeVelora" value="velora" checked /><span class="emoji">‚ú®</span> Let Velora Decide</div>
        <div class="chip" id="chipDrive"><input type="radio" name="modeChoice" id="modeDrive" value="drive" /><span class="emoji">üöó</span> Drive Yourself</div>
        <span id="selectedTimeText" class="muted">‚è∞ Planning for: Now</span>
      </div>
      <div class="recent-searches" id="recentSearches" style="display:none;">
        <span class="label">Recent:</span>
        <div id="recentList"></div>
      </div>
      <div class="vehicle-row" id="vehicleGroup" style="display:none;">
        <span class="label">Do you have your own vehicle?</span>
        <div class="chip" id="chipVehYes"><input type="radio" name="vehChoice" id="vehicleYes" value="yes" /><span class="emoji">‚úÖ</span> Yes</div>
        <div class="chip" id="chipVehNo"><input type="radio" name="vehChoice" id="vehicleNo" value="no" checked /><span class="emoji">üö´</span> No</div>
      </div>
      <div class="form-msg" id="formMsg"></div>
      <input id="arriveBy" type="hidden" value="23:59:59" />
      <input id="planDate" type="hidden" />
    </div>

    <!-- Time Picker Modal -->
    <div id="timeModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="timePickerTitle" style="display:none;">
      <div class="card">
        <div class="row"><h4 id="timePickerTitle" style="margin:0; font-size:18px; color:#0f172a;">üïê Select departure time</h4></div>
        <div class="row">
          <label for="dateInput">Date</label>
          <input id="dateInput" type="date" />
        </div>
        <div class="row">
          <label for="todRange">Time of day</label>
          <input id="todRange" type="range" min="0" max="3" step="1" value="1" />
          <div class="muted" style="display:flex; justify-content:space-between; margin-top:6px;">
            <span>üåÖ 08:00</span><span>‚òÄÔ∏è 12:00</span><span>üåÜ 18:00</span><span>üåô 21:00</span>
          </div>
        </div>
        <div class="actions">
          <button id="cancelTimeBtn" class="ghost-btn" type="button">Leave now</button>
          <button id="confirmTimeBtn" class="action-btn" type="button">Set time</button>
        </div>
      </div>
    </div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div>
        <div class="loader">
          <div class="loader-ring"></div>
          <div class="loader-ring"></div>
          <div class="loader-ring"></div>
        </div>
        <div class="loader-text" id="loadingText">Planning your trip...</div>
      </div>
    </div>

    <div class="content">
      <div id="map"></div>
      <div class="panel">
        <!-- Trip Summary -->
        <div class="section" id="summarySection" style="display:none;">
          <div class="summary-bar">
            <div class="item">
              <span class="label">Total Time</span>
              <span class="value" id="totalTime">-</span>
            </div>
            <div class="item">
              <span class="label">Total Fare</span>
              <span class="value" id="totalFare">‚Çπ-</span>
            </div>
            <div class="item">
              <span class="label">Decision</span>
              <span class="value" id="decisionLabel" style="font-size:14px;">-</span>
            </div>
          </div>
        </div>

        <!-- Compare Mode (hidden by default) -->
        <div class="section" id="compareSection" style="display:none;">
          <h3>‚öñÔ∏è Compare Options</h3>
          <div id="compareGrid" class="compare-grid"></div>
        </div>

        <!-- Itinerary -->
        <div class="section" id="itinerarySection">
          <h3>üó∫Ô∏è Your Itinerary</h3>
          <div id="results"><div class="muted">Submit a search to see your trip plan.</div></div>
        </div>

        <!-- Hotels -->
        <div id="hotelsPanel" class="section" style="display:none;">
          <h3>üè® Nearby Hotels</h3>
          <div id="hotelList" class="hotel-list"></div>
        </div>
        <div id="hotelsAsk" class="chip" style="display:none; align-self:flex-start; cursor:pointer;">üè® See hotels near destination</div>

        <!-- Navigation & Directions -->
        <div class="section">
          <h3>üß≠ Navigation</h3>
          <div class="nav-controls">
            <button id="startNavBtn" class="primary">‚ñ∂ Start Navigation</button>
            <button id="muteBtn" class="ghost-btn" style="display:none;">üîä Mute</button>
            <button id="resetBtn" class="danger">‚èπ Stop</button>
            <span class="info" id="etaText">ETA: -</span>
            <span class="info" id="progressText">Progress: -</span>
          </div>
          <div class="instructions">
            <h4>Step-by-step Directions</h4>
            <div id="instructionsList"><div class="muted">Plan a trip to see turn-by-turn directions.</div></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="./api.config.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <script src="./transit.js?v=20251004_1720"></script>
</body>
</html>
